#include <Arduino.h>
#include "zirconLib.h"  // Asegúrate de tener esta librería en el mismo proyecto

#define INA1 2
#define INB1 5
#define PWM1 3

#define INA2 8
#define INB2 7
#define PWM2 6

#define INA3 11
#define INB3 12
#define PWM3 4
#define START_BYTE 0xAA

// Adafruit_BNO055 bno = Adafruit_BNO055(55, 0x28);
float correccion;
float error = 0;
float initialYaw = 0;
float currentYaw;
float kp = 0.3;


// ---- FUNCIONES DE MOVIMIENTO ----


void parar() {
  analogWrite(PWM1, 0); digitalWrite(INA1, 0); digitalWrite(INB1, 0);
  analogWrite(PWM2, 0); digitalWrite(INA2, 0); digitalWrite(INB2, 0);
  analogWrite(PWM3, 0); digitalWrite(INA3, 0); digitalWrite(INB3, 0);
}
void af() {
  analogWrite(PWM1, 100); digitalWrite(INA1, 1); digitalWrite(INB1, 0);
  analogWrite(PWM2, 100); digitalWrite(INA2, 0); digitalWrite(INB2, 1);
  analogWrite(PWM3, 0);   digitalWrite(INA3, 0); digitalWrite(INB3, 1);
}
void ap() {
  analogWrite(PWM1, 250); digitalWrite(INA1, 1); digitalWrite(INB1, 0);
  analogWrite(PWM2, 250); digitalWrite(INA2, 0); digitalWrite(INB2, 1);
  analogWrite(PWM3, 0);   digitalWrite(INA3, 0); digitalWrite(INB3, 1);
}

void aa() {
  analogWrite(PWM1, 150); digitalWrite(INA1, 0); digitalWrite(INB1, 1);
  analogWrite(PWM2, 150); digitalWrite(INA2, 1); digitalWrite(INB2, 0);
  analogWrite(PWM3, 0);   digitalWrite(INA3, 1); digitalWrite(INB3, 0);}
  // --------SENSORES-----------
  

void setup() {
Serial.begin(9600);
  InitializeZircon();  // Inicializa todo, incluyendo los pines de sensores
  Serial.println("Iniciando lectura de sensores de línea...");
}
void loop()
{ 
  int s1 = readLine(1); // Sensor izquierdo
  int s2 = readLine(2); // Sensor centro
  int s3 = readLine(3); // Sensor derecho

  Serial.print(" s1: ");
  Serial.print(s1);
  Serial.print(" | s2: ");
  Serial.print(s2);
  Serial.print(" | s3: ");
  Serial.println(s3);

  if(s3>650 || s2>650 || s1>650)
  {
    aa();
  }
  else{
    af();
  }
}
